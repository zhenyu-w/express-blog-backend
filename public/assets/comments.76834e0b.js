var ie=Object.defineProperty,ce=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var K=(t,u,o)=>u in t?ie(t,u,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[u]=o,y=(t,u)=>{for(var o in u||(u={}))me.call(u,o)&&K(t,o,u[o]);if(Z)for(var o of Z(u))de.call(u,o)&&K(t,o,u[o]);return t},w=(t,u)=>ce(t,re(u));import{u as ue,g as _e,f as pe,b as ve,c as ne,d as fe}from"./index.d7cf8a03.js";import{f as H,g as P,E as r,U as oe,N as Fe,r as ye,o as a,v as i,j as h,x as l,i as n,M as g,w as f,H as A,W,X as ae,B as C,ag as ge,ah as Q,a6 as se,ai as le,F as Ce,L as he,J as Ee,h as O,Z as ke,$ as Be,m as T}from"./vendor.479a7dc9.js";/* empty css              *//* empty css               *//* empty css               *//* empty css               */import{p as X}from"./purify.es.f60722ef.js";import{c as ee}from"./comment.a2fea787.js";import{u as V}from"./async.8bf78ea0.js";import{r as te}from"./reply.99676f4c.js";var be="/assets/reply-avatar.8cca456e.svg";const Ae={class:"comment__wrapper"},De={class:"comment__info"},Ie=["href"],we={key:1,class:"comment__time"},Re={class:"comment__content"},$e=C("\u56DE\u590D"),Se={key:2,class:"reply-form"},Ue=C("\u53D1\u5E03"),ze={key:3,class:"reply__list"},xe={class:"reply__header"},Le={class:"reply__subinfo"},je={class:"reply__info"},Ne={class:"reply__time"},Me={class:"reply__content"},Te=C("\u56DE\u590D"),Pe={key:0,class:"reply-form"},Ve=C("\u53D1\u5E03"),He=H({name:"CardComment"}),Ye=H(w(y({},He),{props:{comment:{type:Object,require:!0,default:()=>({})},isActive:{type:Boolean,default:!1}},emits:["userInfoEmpty","setActive"],setup(t,{emit:u}){const o=t,{appContext:_}=ge(),F=_.config.globalProperties,U=ue(),E=P(()=>U.commentUserInfo),k=r(""),B=r(""),D=r(!1),z=r(),R=()=>{E.value?(u("setActive"),B.value=`@ ${o.comment.nick_name}`,D.value=!0,I.value=!1,Q(()=>{z.value.focus()})):u("userInfoEmpty")},x=async()=>{if(!k.value){F.$message.warning("\u60A8\u8FD8\u672A\u8F93\u5165\u4EFB\u4F55\u5185\u5BB9\uFF01");return}const e=X.sanitize(k.value);if(!e){F.$message.warning("\u60A8\u7684\u8F93\u5165\u5185\u5BB9\u65E0\u6548\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165\u5408\u6CD5\u5185\u5BB9\uFF01");return}await te.add(y({comment_id:o.comment.id,parent_id:null,approved:0,jump_url:window.location.href,article_id:o.comment.article_id,content:e},E)),F.$Modal.success({title:"\u6E29\u99A8\u63D0\u793A",content:"\u60A8\u7684\u56DE\u590D\u5DF2\u7ECF\u63D0\u4EA4\u6210\u529F\uFF0C\u5F85\u5BA1\u6838\u540E\u5373\u53EF\u751F\u6548\uFF01"}),D.value=!1,k.value=""},{trigger:Y,loading:G}=V(x),I=r(!1),$=r(),p=r(-1),c=oe({content:"",parent_id:-1}),q=e=>{E.value?(u("setActive",o.comment.id),p.value=e.id,B.value=`@ ${e.nick_name}`,D.value=!1,I.value=!0,c.content="",c.parent_id=e.id,Q(()=>{$.value.focus()})):u("userInfoEmpty")},J=async()=>{if(!c.content){F.$message.warning("\u60A8\u8FD8\u672A\u8F93\u5165\u4EFB\u4F55\u5185\u5BB9\uFF01");return}const e=X.sanitize(c.content);if(!e){F.$message.warning("\u60A8\u7684\u8F93\u5165\u5185\u5BB9\u65E0\u6548\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165\u5408\u6CD5\u5185\u5BB9\uFF01");return}await te.add(y({comment_id:o.comment.id,parent_id:c.parent_id,approved:0,jump_url:window.location.href,article_id:o.comment.article_id,content:e},U.commentUserInfo)),F.$Modal.success({title:"\u6E29\u99A8\u63D0\u793A",content:"\u60A8\u7684\u56DE\u590D\u5DF2\u7ECF\u63D0\u4EA4\u6210\u529F\uFF0C\u5F85\u5BA1\u6838\u540E\u5373\u53EF\u751F\u6548\uFF01"}),I.value=!1,c.content="",c.parent_id=-1},{trigger:L,loading:j}=V(J),s=P(()=>{const e=o.comment;return w(y({},e),{avatar:e.avatar||_e,formattedTime:pe(e.create_time,"YYYY\u5E74M\u6708D\u65E5 HH:mm:ss"),jumpoutMiddleLink:e.site_url?`/jumpout/${encodeURIComponent(e.site_url)}`:"",replies:e.replies.map(d=>w(y({},d),{avatar:d.avatar||be,formattedTime:Fe(d.create_time).fromNow()}))})});return(e,d)=>{const b=ve,S=se,N=le,M=ye("my-button");return a(),i(W,null,[h("div",Ae,[l(b,{class:"acomment__avatar","img-src":n(s).avatar},null,8,["img-src"])]),h("div",De,[n(s).site_url?(a(),i("a",{key:0,href:n(s).jumpoutMiddleLink,class:"comment__user",target:"_blank"},g(n(s).nick_name),9,Ie)):(a(),i("span",we,g(n(s).nick_name),1)),h("div",Re,g(n(s).content),1),l(S,{class:"btn-reply",icon:"reply",size:"small",onClick:R},{default:f(()=>[$e]),_:1}),t.isActive&&D.value?(a(),i("div",Se,[l(N,{ref:"rootReplyInputRef",value:k.value,"onUpdate:value":d[0]||(d[0]=m=>k.value=m),size:"small",placeholder:B.value},null,8,["value","placeholder"]),l(S,{class:"btn-confirm-reply",type:"primary",size:"small",loading:n(G),onClick:n(Y)},{default:f(()=>[Ue]),_:1},8,["loading","onClick"])])):A("",!0),n(s).replies.length>0?(a(),i("div",ze,[(a(!0),i(W,null,ae(n(s).replies,m=>(a(),i("div",{key:m.id,class:"reply__card"},[h("div",xe,[l(b,{class:"reply__avatar","img-src":m.avatar},null,8,["img-src"]),h("div",Le,[h("span",je,g(m.nick_name)+"\u56DE\u590D"+g(m.reply_name||n(s).nick_name),1),h("span",Ne,g(m.formattedTime),1)])]),h("div",Me,g(m.content),1),l(M,{class:"btn-reply",icon:"reply",size:"small",onClick:v=>q(m)},{default:f(()=>[Te]),_:2},1032,["onClick"]),t.isActive&&m.id===p.value&&I.value?(a(),i("div",Pe,[l(N,{ref_for:!0,ref_key:"subReplyInputRef",ref:$,value:n(c).content,"onUpdate:value":d[1]||(d[1]=v=>n(c).content=v),size:"small",placeholder:B.value},null,8,["value","placeholder"]),l(S,{class:"btn-confirm-reply",type:"primary",size:"small",loading:n(j),onClick:n(L)},{default:f(()=>[Ve]),_:1},8,["loading","onClick"])])):A("",!0)]))),128))])):A("",!0)])],64)}}}));var Ge=ne(Ye,[["__scopeId","data-v-6a491226"]]);const qe={class:"comments__wtapper"},Je={key:0,class:"leave-comment"},Oe=C("\u53D1\u5E03"),We=["infinite-scroll-disabled"],Xe={key:0,class:"comments__list"},Ze=C("\u52A0\u8F7D\u66F4\u591A"),Ke={key:1,class:"leave-comment"},Qe=C("\u53D1\u5E03"),et=H({name:"Comment"}),tt=H(w(y({},et),{props:{articleId:{type:Number,default:0},topic:{type:String,default:"\u8BC4\u8BBA"},autoLoad:{type:Boolean,default:!0},placeTop:{type:Boolean,default:!1}},setup(t){const u=t,o=ue(),_=r([]),F=r(-1),U=s=>{F.value=s},E=r(0),k=P(()=>E.value===_.value.length),B=oe({pageNo:1,pageSize:6}),D=async(s=!1)=>{const e=await ee.page(w(y({},B),{id:u.articleId}));s?_.value=[..._.value,...e.data]:_.value=e.data,E.value=e.total},{trigger:z,loading:R}=V(D);Ce(()=>{z()});const x=()=>{!R.value&&_.value.length<E.value&&(B.pageNo++,z(!0))},Y=P(()=>o.commentUserInfo),G=r(!1),I=()=>{$()},$=()=>{T.warning(`\u8BF7\u5728${u.topic}\u524D\u586B\u5199\u90E8\u5206\u5FC5\u8981\u4FE1\u606F\uFF0C\u6211\u4EEC\u4E0D\u4F1A\u516C\u5F00\u60A8\u7684\u79C1\u5BC6\u4FE1\u606F\uFF01`),G.value=!0},p=r(""),c=r(),q=()=>{c.value.focus()},J=async()=>{if(!Y.value){$();return}if(!p.value){T.warning("\u60A8\u8FD8\u672A\u8F93\u5165\u4EFB\u4F55\u5185\u5BB9\uFF01");return}const s=X.sanitize(p.value);if(!s){T.warning("\u60A8\u7684\u8F93\u5165\u5185\u5BB9\u65E0\u6548\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165\u5408\u6CD5\u5185\u5BB9\uFF01");return}const e=y({article_id:u.articleId,content:s,approved:0,jump_url:window.location.href},o.commentUserInfo);await ee.add(e),p.value="",T.success(`\u60A8\u7684${u.topic}\u5DF2\u7ECF\u63D0\u4EA4\u6210\u529F\uFF0C\u5F85\u5BA1\u6838\u540E\u5373\u53EF\u751F\u6548\uFF01`)},{trigger:L,loading:j}=V(J);return(s,e)=>{const d=le,b=se,S=ke,N=Be,M=fe,m=he("infinite-scroll");return a(),i("section",qe,[t.placeTop?(a(),i("div",Je,[l(d,{ref_key:"commentInputRef",ref:c,value:p.value,"onUpdate:value":e[0]||(e[0]=v=>p.value=v),placeholder:`\u53D1\u8868${t.topic}`},null,8,["value","placeholder"]),l(b,{class:"btn-publish",type:"primary",size:"small",loading:n(j),onClick:n(L)},{default:f(()=>[Oe]),_:1},8,["loading","onClick"])])):A("",!0),Ee((a(),i("div",{"infinite-scroll-distance":50,"infinite-scroll-disabled":!t.autoLoad,class:"comments__body"},[_.value.length?(a(),i("ul",Xe,[(a(!0),i(W,null,ae(_.value,v=>(a(),i("li",{key:v.id},[l(Ge,{comment:v,"is-active":F.value===v.id,onUserInfoEmty:I,onSetActive:U},null,8,["comment","is-active"])]))),128))])):n(R)?A("",!0):(a(),O(S,{key:1},{description:f(()=>[C(" \u6682\u65E0"+g(t.topic)+"\uFF0C\u5FEB\u6765\u8BF4\u4E24\u53E5\u5427\uFF01 ",1),l(b,{class:"btn-add",type:"primary",onClick:q},{default:f(()=>[C("\u521B\u5EFA "+g(t.topic),1)]),_:1})]),_:1})),l(N,{loading:n(R),active:"",avatar:"",paragraph:{row:6}},null,8,["loading"]),n(k)?(a(),O(M,{key:2,content:"\u6CA1\u6709\u66F4\u591A\u4E86"})):_.value.length>0?(a(),O(M,{key:3},{default:f(()=>[l(b,{shape:"round",type:"primary",onClick:x},{default:f(()=>[Ze]),_:1})]),_:1})):A("",!0)],8,We)),[[m,x]]),t.placeTop?A("",!0):(a(),i("div",Ke,[l(d,{ref_key:"commentInputRef",ref:c,value:p.value,"onUpdate:value":e[1]||(e[1]=v=>p.value=v),placeholder:`\u53D1\u8868${t.topic}`},null,8,["value","placeholder"]),l(b,{class:"btn-publish",type:"primary",size:"small",loading:n(j),onClick:n(L)},{default:f(()=>[Qe]),_:1},8,["loading","onClick"])]))])}}}));var _t=ne(tt,[["__scopeId","data-v-9eb47534"]]);export{_t as C};
