var Te=Object.defineProperty,Ae=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var K=(g,p,o)=>p in g?Te(g,p,{enumerable:!0,configurable:!0,writable:!0,value:o}):g[p]=o,T=(g,p)=>{for(var o in p||(p={}))Re.call(p,o)&&K(g,o,p[o]);if(q)for(var o of q(p))$e.call(p,o)&&K(g,o,p[o]);return g},A=(g,p)=>Ae(g,Le(p));import{f as te,g as L,u as Ue,T as Ne,E as h,U as S,t as Pe,F as Me,o as x,v as R,x as a,w as t,i as l,aL as Y,B as b,M as O,j as ue,W as V,X as z,aM as Z,y as je,A as Se,ag as Oe,a6 as Ve,am as ze,ai as He,aN as Qe,al as Ge,an as Je,ap as We,D as Xe,C as qe,as as Ke,aO as Ye,aP as Ze,R as ea,h as H,aQ as ee,aR as aa}from"./vendor.479a7dc9.js";/* empty css               *//* empty css               *//* empty css                *//* empty css               *//* empty css                *//* empty css               */import{H as B,j as ta,x as ua,c as la,s as sa,a as na,p as oa,m as $}from"./atom-one-dark.185653e8.js";import{p as ae}from"./purify.es.f60722ef.js";import{R as U}from"./validator.fb7ac551.js";import{u as Q}from"./async.8bf78ea0.js";import{c as ra}from"./category.2e4ded72.js";import{a as G}from"./article.89825cff.js";import{c as ia,u as ca}from"./index.d7cf8a03.js";const da=g=>(je("data-v-2d839de4"),g=g(),Se(),g),ga={class:"workspace__wrapper"},pa=da(()=>ue("div",{style:{marginTop:"20px"}},null,-1)),ma=b("\u5426"),_a=b("\u662F"),va=["innerHTML"],fa=te({name:"BackendArticle"}),Ca=te(A(T({},fa),{setup(g){B.registerLanguage("javascript",ta),B.registerLanguage("html",ua),B.registerLanguage("css",la),B.registerLanguage("shell",sa),B.registerLanguage("json",na),B.registerLanguage("plaintext",oa);const{appContext:p}=Oe(),o=p.config.globalProperties,le=ca(),se=L(()=>le.userInfo),N=Ue(),ne=Ne(),J=h(),i=S({articleText:"",private:0,poster:"",articleTitle:"",summary:""}),D=h(!1),oe=S({poster:[U],articleTitle:[U],summary:[U],articleText:[U]}),E=h(null),re=L(()=>{var u;return((u=E.value)==null?void 0:u.tags.map(e=>e.tagName))||[]}),ie=L(()=>{var u;return((u=E.value)==null?void 0:u.categories.map(e=>e.id))||[]}),W=async()=>{if(N.params.id){D.value=!0;const u=+N.params.id,{data:e}=await G.detail(u);if(E.value=e,Object.assign(i,{articleText:e.article_text,articleTitle:e.article_name,poster:e.poster,summary:e.summary,private:e.private}),i.articleText){const n=$(i.articleText);P.value=ae.sanitize(n)}e.tags.length>0&&(v.value=e.tags.map(n=>({value:n.tagName}))),e.categories.length>0&&(_.oldCategoryIds=e.categories.map(n=>n.id))}},{trigger:ce,loading:de}=Q(W),ge=()=>{const u=new $.Renderer;u.link=function(n,c,m){return`<a class="link" href="${n}" target="_blank" title="${m}">${m}</a>`},u.image=function(n,c,m){return`<a class="img-wrapper" href="${n}" target="_blank" title="${m}"><img src="${n}" alt="${m}"></a>`},$.setOptions({renderer:u,highlight:function(e,n){const c=B.getLanguage(n)?n:"plaintext";return B.highlight(e,{language:c}).value},pedantic:!1,gfm:!0,breaks:!1,sanitize:!1,smartLists:!0,smartypants:!1,xhtml:!1})},P=h(""),pe=Pe(({target:u})=>{const e=u.value,n=$(e);P.value=ae.sanitize(n)},300),me=async()=>{await J.value.validate(),M.value=!0},{trigger:_e,loading:ve}=Q(me),M=h(!1),_=S({oldCategoryIds:[]}),v=h([]),fe=()=>{v.value.length>0?v.value.some(e=>e.value==="")?o.$message.warning("\u8BF7\u5148\u8F93\u5165\u5DF2\u6DFB\u52A0\u7684\u6807\u7B7E\u5185\u5BB9"):v.value.length>=4?o.$message.warning("\u6700\u591A\u6DFB\u52A04\u4E2A\u6807\u7B7E"):v.value.push({value:""}):v.value.push({value:""})},Ce=u=>{v.value.splice(u,1)},C=h([]),ye=()=>{C.value.length>0?C.value.some(e=>e.value==="")?o.$message.warning("\u8BF7\u5148\u8F93\u5165\u5DF2\u6DFB\u52A0\u7684\u5206\u7C7B"):C.value.length>=4?o.$message.warning("\u6700\u591A\u6DFB\u52A04\u4E2A\u5206\u7C7B"):C.value.push({value:""}):C.value.push({value:""})},he=u=>{C.value.splice(u,1)},j=h([]),Be=L(()=>j.value.map(u=>u.category_name)),Fe=async()=>{const u=await ra.all();j.value=u.data},xe=async()=>{var m;const u=v.value.filter(r=>r.value.trim()!=="").map(r=>r.value.trim());if(u.length===0)return o.$message.warning("\u81F3\u5C11\u8F93\u5165\u4E00\u4E2A\u6807\u7B7E"),Promise.reject(!1);const e=C.value.filter(r=>r.value.trim()!=="").map(r=>r.value.trim());let n=!1,c="";for(let r=0,F=e.length;r<F;r++){const y=e[r];if(Be.value.includes(y)){n=!0,c=y;break}}if(n)return o.$message.warning(`\u65B0\u589E\u7684\u5206\u7C7B\u540D\u79F0[${c}]\u5DF2\u7ECF\u5B58\u5728\uFF0C\u8BF7\u5220\u9664\u540E\u76F4\u63A5\u5728\u5DF2\u6709\u5206\u7C7B\u4E2D\u9009\u62E9`),Promise.reject(!1);if(e.length===0&&_.oldCategoryIds.length===0)return o.$message.warning("\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5206\u7C7B"),Promise.reject(!1);if(D.value){const r=E.value.tags.filter(d=>!u.includes(d.tagName)).map(d=>d.id),F=u.filter(d=>!re.value.includes(d)),y=E.value.categories.filter(d=>!_.oldCategoryIds.includes(d.id)).map(d=>d.id),I=_.oldCategoryIds.filter(d=>!ie.value.includes(d)),f=A(T({id:+N.params.id},i),{deleteTagIDs:r.length>0?r:null,newTags:F.length>0?F:null,deleteCategoryIDs:y.length>0?y:null,newCategories:e.length>0?e:null,relatedCategoryIDs:I.length>0?I:null});await G.update(f),o.$message.success("\u4FDD\u5B58\u6210\u529F")}else{const r=A(T({authorId:(m=se.value)==null?void 0:m.id},i),{oldCategoryIds:_.oldCategoryIds.length>0?_.oldCategoryIds:null,tags:u,newCategories:e.length>0?e:null});await G.add(r),o.$message.success("\u521B\u4F5C\u6210\u529F")}ne.push("/backend")},{trigger:Ee,loading:we}=Q(xe);return Me(()=>{W(),ge(),ce(),Fe()}),(u,e)=>{const n=Ve,c=ze,m=He,r=Qe,F=Ge,y=Je,I=We,f=Xe,d=qe,X=Ke,ke=Ye,be=aa,De=Ze,Ie=ea;return x(),R("section",ga,[a(ke,{spinning:l(de)},{default:t(()=>[a(X,{ref_key:"formRef",ref:J,class:"form-write",model:l(i),rules:l(oe),"wrapper-col":{span:24},"label-align":"right"},{default:t(()=>[a(c,null,{default:t(()=>[a(n,{type:"primary",loading:l(ve),onClick:Y(l(_e),["prevent"])},{default:t(()=>[b(O(D.value?"\u4FDD\u5B58\u535A\u5BA2":"\u53D1\u5E03\u535A\u5BA2"),1)]),_:1},8,["loading","onClick"])]),_:1}),a(c,{name:"poster",label:"\u5C01\u9762url"},{default:t(()=>[a(m,{value:l(i).poster,"onUpdate:value":e[0]||(e[0]=s=>l(i).poster=s),class:"input-simple",placeholder:"\u6682\u65F6\u4F7F\u7528\u5728\u7EBF\u56FE\u7247URL\uFF0C\u6BD4\u5982\u4E03\u725B\u4E91\u7B49\u4E91\u5B58\u50A8\u5730\u5740"},null,8,["value"]),pa,a(r,{width:200,src:l(i).poster},null,8,["src"])]),_:1}),a(c,{name:"articleTitle",label:"\u6587\u7AE0\u6807\u9898"},{default:t(()=>[a(m,{value:l(i).articleTitle,"onUpdate:value":e[1]||(e[1]=s=>l(i).articleTitle=s),class:"input-simple",placeholder:"\u8BF7\u8F93\u5165\u6807\u9898"},null,8,["value"])]),_:1}),a(c,{name:"summary",label:"\u6587\u7AE0\u6458\u8981"},{default:t(()=>[a(F,{value:l(i).summary,"onUpdate:value":e[2]||(e[2]=s=>l(i).summary=s),class:"input-simple",placeholder:"\u8BF7\u8F93\u5165\u6587\u7AE0\u6458\u8981","auto-size":{minRows:2,maxRows:4}},null,8,["value"])]),_:1}),a(c,{name:"private",label:"\u662F\u5426\u79C1\u5BC6"},{default:t(()=>[a(I,{value:l(i).private,"onUpdate:value":e[3]||(e[3]=s=>l(i).private=s)},{default:t(()=>[a(y,{value:0},{default:t(()=>[ma]),_:1}),a(y,{value:1},{default:t(()=>[_a]),_:1})]),_:1},8,["value"])]),_:1}),a(c,{name:"articleText",label:"\u6B63\u6587\u90E8\u5206"},{default:t(()=>[a(d,{gutter:20},{default:t(()=>[a(f,{span:12},{default:t(()=>[a(F,{value:l(i).articleText,"onUpdate:value":e[4]||(e[4]=s=>l(i).articleText=s),class:"md-textarea",placeholder:"\u8BF7\u8F93\u5165markdown\u683C\u5F0F\u7684\u6B63\u6587",onChange:l(pe)},null,8,["value","onChange"])]),_:1}),a(f,{span:12},{default:t(()=>[ue("section",{class:"md-preview",innerHTML:P.value},null,8,va)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["spinning"]),a(Ie,{visible:M.value,"onUpdate:visible":e[6]||(e[6]=s=>M.value=s),title:"\u5173\u8054\u5206\u7C7B/\u6807\u7B7E",footer:null,width:"860px"},{default:t(()=>[a(X,{ref:"relFormRef",class:"form-releation",model:l(_),"wrapper-col":{span:24}},{default:t(()=>[a(c,{name:"newTags",label:"\u6587\u7AE0\u6807\u7B7E"},{default:t(()=>[a(d,{gutter:16},{default:t(()=>[(x(!0),R(V,null,z(v.value,(s,w)=>(x(),H(f,{key:w,xs:8,sm:4},{default:t(()=>[a(m,{value:s.value,"onUpdate:value":k=>s.value=k},null,8,["value","onUpdate:value"]),a(l(ee),{onClick:k=>Ce(w)},null,8,["onClick"])]),_:2},1024))),128)),a(f,{span:4},{default:t(()=>[a(l(Z),{onClick:fe})]),_:1})]),_:1})]),_:1}),a(c,{name:"newCategorys",label:"\u65B0\u589E\u5206\u7C7B"},{default:t(()=>[a(d,{gutter:16},{default:t(()=>[(x(!0),R(V,null,z(C.value,(s,w)=>(x(),H(f,{key:w,xs:8,sm:4},{default:t(()=>[a(m,{value:s.value,"onUpdate:value":k=>s.value=k},null,8,["value","onUpdate:value"]),a(l(ee),{onClick:k=>he(w)},null,8,["onClick"])]),_:2},1024))),128)),a(f,{span:4},{default:t(()=>[a(l(Z),{onClick:ye})]),_:1})]),_:1})]),_:1}),a(c,{name:"categorys",label:"\u5DF2\u6709\u5206\u7C7B"},{default:t(()=>[a(De,{value:l(_).oldCategoryIds,"onUpdate:value":e[5]||(e[5]=s=>l(_).oldCategoryIds=s)},{default:t(()=>[a(d,{gutter:16},{default:t(()=>[(x(!0),R(V,null,z(j.value,s=>(x(),H(f,{key:s.id,xs:8,sm:4},{default:t(()=>[a(be,{class:"category-checkbox",value:s.id},{default:t(()=>[b(O(s.category_name),1)]),_:2},1032,["value"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1}),a(c,{class:"align-center"},{default:t(()=>[a(n,{type:"primary",loading:l(we),onClick:Y(l(Ee),["prevent"])},{default:t(()=>[b(O(D.value?"\u786E\u8BA4\u4FDD\u5B58":"\u786E\u8BA4\u53D1\u5E03"),1)]),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])}}}));var Ua=ia(Ca,[["__scopeId","data-v-2d839de4"]]);export{Ua as default};
